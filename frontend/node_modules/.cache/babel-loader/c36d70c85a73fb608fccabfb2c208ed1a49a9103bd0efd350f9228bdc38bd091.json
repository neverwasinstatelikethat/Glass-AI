{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useEffect, useRef } from 'react';\nconst useDashboardData = () => {\n  _s();\n  const [data, setData] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const wsRef = useRef(null);\n  const API_BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:8000';\n  useEffect(() => {\n    const fetchData = async () => {\n      try {\n        setLoading(true);\n        setError(null);\n\n        // Fetch quality metrics\n        const qualityResponse = await fetch(`${API_BASE_URL}/api/quality/metrics`);\n        const qualityData = await qualityResponse.json();\n\n        // Fetch active alerts\n        const alertsResponse = await fetch(`${API_BASE_URL}/api/alerts/active`);\n        const alertsData = await alertsResponse.json();\n\n        // Fetch recommendations\n        const recommendationsResponse = await fetch(`${API_BASE_URL}/api/recommendations`);\n        const recommendationsData = await recommendationsResponse.json();\n\n        // Construct dashboard data\n        const dashboardData = {\n          kpiData: {\n            qualityRate: qualityData.quality_rate || 0,\n            defectCount: qualityData.defect_count || 0,\n            unitsProduced: qualityData.total_units || 0,\n            uptime: qualityData.uptime || 0\n          },\n          defectDistribution: [],\n          performanceData: [],\n          realTimeMetrics: [],\n          aiRecommendations: recommendationsData.map(rec => {\n            var _rec$urgency;\n            return {\n              text: rec.description || 'Рекомендация по оптимизации процесса',\n              priority: ((_rec$urgency = rec.urgency) === null || _rec$urgency === void 0 ? void 0 : _rec$urgency.toLowerCase()) || 'medium',\n              impact: Math.round((rec.confidence || 0.5) * 100),\n              icon: 'Psychology'\n            };\n          })\n        };\n        setData(dashboardData);\n        setLoading(false);\n      } catch (err) {\n        console.error('Error fetching dashboard data:', err);\n        setError(err.message || 'Failed to load dashboard data');\n        setData(null);\n        setLoading(false);\n      }\n    };\n    fetchData();\n\n    // Set up WebSocket connection for real-time updates\n    const wsUrl = API_BASE_URL.replace('http', 'ws') + '/ws/realtime';\n    wsRef.current = new WebSocket(wsUrl);\n    wsRef.current.onopen = () => {\n      console.log('WebSocket connected for real-time updates');\n    };\n    wsRef.current.onmessage = event => {\n      try {\n        const message = JSON.parse(event.data);\n        if (message.type === 'realtime_update' && message.data) {\n          // Update KPI data with real-time values\n          setData(prevData => {\n            if (!prevData) return prevData;\n            return {\n              ...prevData,\n              kpiData: {\n                ...prevData.kpiData,\n                qualityRate: message.data.current_quality_rate || prevData.kpiData.qualityRate,\n                defectCount: message.data.defect_count_hourly || prevData.kpiData.defectCount\n              }\n            };\n          });\n        }\n      } catch (err) {\n        console.error('Error parsing WebSocket message:', err);\n      }\n    };\n    wsRef.current.onerror = err => {\n      console.error('WebSocket error:', err);\n    };\n\n    // Set up polling for periodic updates\n    const interval = setInterval(fetchData, 30000); // Update every 30 seconds\n\n    return () => {\n      clearInterval(interval);\n      if (wsRef.current) {\n        wsRef.current.close();\n      }\n    };\n  }, [API_BASE_URL]);\n  return {\n    data,\n    loading,\n    error\n  };\n};\n_s(useDashboardData, \"A+hq8wNYtaw0bjhLzvNuYVJ6m7I=\");\nexport default useDashboardData;","map":{"version":3,"names":["useState","useEffect","useRef","useDashboardData","_s","data","setData","loading","setLoading","error","setError","wsRef","API_BASE_URL","process","env","REACT_APP_API_URL","fetchData","qualityResponse","fetch","qualityData","json","alertsResponse","alertsData","recommendationsResponse","recommendationsData","dashboardData","kpiData","qualityRate","quality_rate","defectCount","defect_count","unitsProduced","total_units","uptime","defectDistribution","performanceData","realTimeMetrics","aiRecommendations","map","rec","_rec$urgency","text","description","priority","urgency","toLowerCase","impact","Math","round","confidence","icon","err","console","message","wsUrl","replace","current","WebSocket","onopen","log","onmessage","event","JSON","parse","type","prevData","current_quality_rate","defect_count_hourly","onerror","interval","setInterval","clearInterval","close"],"sources":["C:/Users/hehehe/Desktop/scripts/glass_ai/frontend/src/hooks/useDashboardData.ts"],"sourcesContent":["import { useState, useEffect, useRef } from 'react';\r\n\r\ninterface KPIData {\r\n  qualityRate: number;\r\n  defectCount: number;\r\n  unitsProduced: number;\r\n  uptime: number;\r\n}\r\n\r\ninterface DefectDistribution {\r\n  name: string;\r\n  value: number;\r\n  color: string;\r\n}\r\n\r\ninterface PerformanceDataPoint {\r\n  time: string;\r\n  quality: number;\r\n  defects: number;\r\n}\r\n\r\ninterface RealTimeMetric {\r\n  name: string;\r\n  value: number;\r\n  unit: string;\r\n  max: number;\r\n  trend: 'up' | 'down' | 'stable';\r\n  icon: string;\r\n}\r\n\r\ninterface AIRecommendation {\r\n  text: string;\r\n  priority: 'high' | 'medium' | 'low';\r\n  impact: number;\r\n  icon: string;\r\n}\r\n\r\ninterface DashboardData {\r\n  kpiData: KPIData;\r\n  defectDistribution: DefectDistribution[];\r\n  performanceData: PerformanceDataPoint[];\r\n  realTimeMetrics: RealTimeMetric[];\r\n  aiRecommendations: AIRecommendation[];\r\n}\r\n\r\nconst useDashboardData = () => {\r\n  const [data, setData] = useState<DashboardData | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const wsRef = useRef<WebSocket | null>(null);\r\n\r\n  const API_BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:8000';\r\n\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      try {\r\n        setLoading(true);\r\n        setError(null);\r\n        \r\n        // Fetch quality metrics\r\n        const qualityResponse = await fetch(`${API_BASE_URL}/api/quality/metrics`);\r\n        const qualityData = await qualityResponse.json();\r\n        \r\n        // Fetch active alerts\r\n        const alertsResponse = await fetch(`${API_BASE_URL}/api/alerts/active`);\r\n        const alertsData = await alertsResponse.json();\r\n        \r\n        // Fetch recommendations\r\n        const recommendationsResponse = await fetch(`${API_BASE_URL}/api/recommendations`);\r\n        const recommendationsData = await recommendationsResponse.json();\r\n        \r\n        // Construct dashboard data\r\n        const dashboardData: DashboardData = {\r\n          kpiData: {\r\n            qualityRate: qualityData.quality_rate || 0,\r\n            defectCount: qualityData.defect_count || 0,\r\n            unitsProduced: qualityData.total_units || 0,\r\n            uptime: qualityData.uptime || 0\r\n          },\r\n          defectDistribution: [],\r\n          performanceData: [],\r\n          realTimeMetrics: [],\r\n          aiRecommendations: recommendationsData.map((rec: any) => ({\r\n            text: rec.description || 'Рекомендация по оптимизации процесса',\r\n            priority: rec.urgency?.toLowerCase() || 'medium',\r\n            impact: Math.round((rec.confidence || 0.5) * 100),\r\n            icon: 'Psychology'\r\n          }))\r\n        };\r\n\r\n        setData(dashboardData);\r\n        setLoading(false);\r\n      } catch (err: any) {\r\n        console.error('Error fetching dashboard data:', err);\r\n        setError(err.message || 'Failed to load dashboard data');\r\n        setData(null);\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchData();\r\n    \r\n    // Set up WebSocket connection for real-time updates\r\n    const wsUrl = API_BASE_URL.replace('http', 'ws') + '/ws/realtime';\r\n    wsRef.current = new WebSocket(wsUrl);\r\n    \r\n    wsRef.current.onopen = () => {\r\n      console.log('WebSocket connected for real-time updates');\r\n    };\r\n    \r\n    wsRef.current.onmessage = (event) => {\r\n      try {\r\n        const message = JSON.parse(event.data);\r\n        if (message.type === 'realtime_update' && message.data) {\r\n          // Update KPI data with real-time values\r\n          setData(prevData => {\r\n            if (!prevData) return prevData;\r\n            \r\n            return {\r\n              ...prevData,\r\n              kpiData: {\r\n                ...prevData.kpiData,\r\n                qualityRate: message.data.current_quality_rate || prevData.kpiData.qualityRate,\r\n                defectCount: message.data.defect_count_hourly || prevData.kpiData.defectCount,\r\n              }\r\n            };\r\n          });\r\n        }\r\n      } catch (err) {\r\n        console.error('Error parsing WebSocket message:', err);\r\n      }\r\n    };\r\n    \r\n    wsRef.current.onerror = (err) => {\r\n      console.error('WebSocket error:', err);\r\n    };\r\n    \r\n    // Set up polling for periodic updates\r\n    const interval = setInterval(fetchData, 30000); // Update every 30 seconds\r\n    \r\n    return () => {\r\n      clearInterval(interval);\r\n      if (wsRef.current) {\r\n        wsRef.current.close();\r\n      }\r\n    };\r\n  }, [API_BASE_URL]);\r\n\r\n  return { data, loading, error };\r\n};\r\n\r\nexport default useDashboardData;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}