# Промышленные коннекторы Glass AI

## Обзор

Промышленные коннекторы Glass AI обеспечивают подключение к различным источникам данных в промышленной среде производства стекла. Они поддерживают стандартные промышленные протоколы и обеспечивают надежную передачу данных от оборудования к системе аналитики.

## Архитектура

```
Промышленные коннекторы
├── OPC UA клиент
│   ├── Подключение к серверам
│   ├── Чтение тегов
│   └── Обработка разрывов
├── Modbus драйвер
│   ├── TCP/RTU коммуникация
│   ├── Чтение/запись регистров
│   └── Обработка ошибок
├── Поток данных с камеры МИК-1
│   ├── Захват изображений
│   ├── Обработка видеопотока
│   └── Передача данных
└── Агрегатор датчиков
    ├── Сбор данных
    ├── Преобразование форматов
    └── Буферизация
```

## Основные компоненты

### 1. OPC UA клиент (`opc_ua_client.py`)
Клиент для подключения к серверам OPC UA в промышленной среде.

#### Особенности:
- **Подключение к серверам**: Безопасное подключение к промышленным серверам OPC UA
- **Чтение тегов**: Получение данных в реальном времени от тегов
- **Обработка разрывов**: Автоматическое переподключение при потере соединения
- **Безопасность**: Поддержка аутентификации и шифрования

#### Поддерживаемые функции:
- **Асинхронные операции**: Неблокирующее чтение данных
- **Подписки**: Подписка на изменения значений тегов
- **Пакетные операции**: Чтение множества тегов за один запрос
- **Мониторинг состояния**: Отслеживание состояния подключения

### 2. Modbus драйвер (`modbus_driver.py`)
Драйвер для коммуникации с устройствами по протоколу Modbus.

#### Особенности:
- **TCP/RTU поддержка**: Поддержка обоих вариантов протокола Modbus
- **Чтение/запись регистров**: Операции с holding, input, coil регистрами
- **Обработка ошибок**: Корректная обработка ошибок связи
- **Конфигурация устройств**: Настройка параметров подключения

#### Поддерживаемые функции:
- **Функции 1-4**: Чтение coils, discrete inputs, holding registers, input registers
- **Функции 5, 6, 15, 16**: Запись coils и регистров
- **Pooling**: Опрос устройств с заданной частотой
- **Retry mechanism**: Повторные попытки при ошибках

### 3. Поток данных с камеры МИК-1 (`mik1_camera_stream.py`)
Обработка видеопотока с камеры МИК-1 для контроля качества.

#### Особенности:
- **Захват изображений**: Получение изображений с камеры в реальном времени
- **Обработка видеопотока**: Предварительная обработка изображений
- **Передача данных**: Передача изображений в систему компьютерного зрения
- **Контроль качества**: Мониторинг качества видеопотока

#### Поддерживаемые функции:
- **Различные форматы**: Поддержка JPEG, PNG, RAW
- **Настройка параметров**: Яркость, контраст, экспозиция
- **Детекция движения**: Определение активности на изображениях
- **Буферизация**: Временное хранение изображений при проблемах

### 4. Агрегатор датчиков (`sensor_aggregator.py`)
Агрегация данных от множества датчиков в унифицированный формат.

#### Особенности:
- **Сбор данных**: Получение данных от различных источников
- **Преобразование форматов**: Приведение данных к стандартному формату
- **Буферизация**: Временное хранение данных при недоступности систем
- **Фильтрация**: Предварительная фильтрация и валидация данных

#### Поддерживаемые функции:
- **Многопоточность**: Параллельная обработка данных от разных источников
- **Приоритезация**: Обработка критических данных с высоким приоритетом
- **Агрегация**: Комбинирование данных от связанных датчиков
- **Аномалии**: Обнаружение и маркировка аномальных значений

## Поддерживаемые протоколы

### OPC UA
Стандарт промышленной коммуникации для обмена данными между устройствами.

#### Особенности:
- **Платформонезависимость**: Работает на различных платформах
- **Безопасность**: Встроенные механизмы безопасности
- **Модель данных**: Богатая модель данных с типами и методами
- **События**: Поддержка событий и алярмов

#### Поддерживаемые серверы:
- **Siemens S7**: SIMATIC WinCC OA, PCS 7
- **Rockwell Automation**: FactoryTalk, ControlLogix
- **Schneider Electric**: EcoStruxure
- **Custom servers**: Собственные реализации OPC UA серверов

### Modbus
Простой протокол для связи между промышленными устройствами.

#### Особивости:
- **Простота**: Минимальные требования к ресурсам
- **Надежность**: Проверенный временем протокол
- **Широкое распространение**: Поддерживается большинством ПЛК
- **Гибкость**: Поддержка различных физических интерфейсов

#### Варианты:
- **Modbus TCP**: Ethernet/IP вариант протокола
- **Modbus RTU**: Вариант для последовательных интерфейсов
- **Modbus ASCII**: Человекочитаемый вариант RTU

### Камеры МИК-1
Системы машинного зрения для контроля качества продукции.

#### Особенности:
- **Высокое разрешение**: Подробные изображения продукции
- **Высокая скорость**: Быстрый захват изображений
- **Интеграция**: Простая интеграция с системами контроля
- **Гибкость**: Настраиваемые параметры захвата

#### Поддерживаемые функции:
- **Цветные/монохромные**: Поддержка различных типов камер
- **Различные интерфейсы**: GigE, USB 3.0, Camera Link
- **Триггеры**: Внешние и внутренние триггеры захвата
- **ROI**: Выбор областей интереса

## Конфигурация

### Формат конфигурации:
```json
{
  "opc_ua": {
    "servers": [
      {
        "url": "opc.tcp://server1:4840",
        "username": "user",
        "password": "pass",
        "tags": ["Temperature", "Pressure", "Speed"]
      }
    ]
  },
  "modbus": {
    "devices": [
      {
        "address": "192.168.1.100",
        "port": 502,
        "slave_id": 1,
        "registers": [
          {"address": 0, "type": "holding", "name": "furnace_temp"},
          {"address": 1, "type": "holding", "name": "belt_speed"}
        ]
      }
    ]
  },
  "mik1_camera": {
    "camera_ip": "192.168.1.101",
    "port": 80,
    "frame_rate": 30,
    "resolution": "1920x1080"
  }
}
```

### Управление подключениями:
- **Connection pooling**: Повторное использование подключений
- **Timeout handling**: Обработка таймаутов
- **Retry logic**: Повторные попытки подключения
- **Graceful shutdown**: Корректное завершение соединений

## Безопасность

### Аутентификация:
- **Username/password**: Базовая аутентификация
- **Certificates**: Аутентификация по сертификатам
- **Anonymous**: Анонимный доступ (ограниченно)

### Шифрование:
- **TLS/SSL**: Шифрование для OPC UA и Modbus TCP
- **Certificate validation**: Проверка сертификатов
- **Secure channels**: Защищенные каналы связи

### Контроль доступа:
- **Role-based access**: Доступ на основе ролей
- **Tag-level security**: Безопасность на уровне тегов
- **Audit trails**: Журналы доступа и изменений

## Мониторинг и диагностика

### Метрики подключений:
- **Connection status**: Статус подключений
- **Data rate**: Скорость передачи данных
- **Error rate**: Частота ошибок
- **Latency**: Задержка передачи данных

### Логирование:
- **Connection events**: События подключения/отключения
- **Data transfer**: Передача данных
- **Errors and warnings**: Ошибки и предупреждения
- **Performance metrics**: Метрики производительности

### Алерты:
- **Connection loss**: Потеря подключения
- **Data quality issues**: Проблемы с качеством данных
- **Performance degradation**: Снижение производительности
- **Security events**: События безопасности

## Интеграция с другими модулями

### С системой сбора данных:
- **Передача данных**: Надежная передача данных в систему сбора
- **Backpressure handling**: Обработка перегрузки системы
- **Data buffering**: Буферизация при временных сбоях

### С цифровым двойником:
- **Симуляция данных**: Генерация синтетических данных для тестирования
- **Валидация подключений**: Проверка корректности подключений
- **Тестирование сценариев**: Тестирование отказов оборудования

## Производительность

### Пропускная способность:
- **OPC UA**: 1000+ тегов/сек
- **Modbus TCP**: 100+ регистров/сек
- **Камеры МИК-1**: 30+ кадров/сек (Full HD)

### Задержка:
- **OPC UA**: < 10 мс
- **Modbus TCP**: < 5 мс
- **Камеры МИК-1**: < 33 мс (30 FPS)

### Масштабируемость:
- **Горизонтальное масштабирование**: Поддержка множества подключений
- **Вертикальное масштабирование**: Увеличение ресурсов для одного подключения
- **Load balancing**: Балансировка нагрузки между экземплярами

## Тестирование

### Юнит-тесты:
```bash
pytest tests/industrial_connectors/
```

### Интеграционные тесты:
- Тестирование подключения к реальным устройствам
- Тестирование обработки ошибок
- Тестирование восстановления после сбоев

### Тесты производительности:
- Измерение пропускной способности
- Тестирование задержек
- Стресс-тестирование при высокой нагрузке

## Развертывание

### Локальное развертывание:
```bash
python -m industrial_connectors.opc_ua_client
```

### Docker развертывание:
```dockerfile
FROM python:3.8-slim

WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt

COPY industrial_connectors/ industrial_connectors/

CMD ["python", "-m", "industrial_connectors.opc_ua_client"]
```

## Устранение неполадок

### Распространенные проблемы:

1. **Потеря подключения к OPC UA серверу**:
   - Проверьте сетевое соединение
   - Убедитесь, что сервер доступен
   - Проверьте учетные данные

2. **Ошибки Modbus**:
   - Проверьте адреса устройств
   - Убедитесь в корректности параметров подключения
   - Проверьте проводку и терминирование

3. **Проблемы с камерой МИК-1**:
   - Проверьте сетевое подключение
   - Убедитесь в доступности IP-адреса камеры
   - Проверьте настройки захвата

## Версионирование

### Управление версиями:
- **SemVer**: Семантическое версионирование коннекторов
- **Git tags**: Тегирование релизов
- **Changelog**: Журнал изменений

### Откат версий:
- **Сохранение старых версий**: Архивирование предыдущих реализаций
- **Совместимость**: Поддержка обратной совместимости
- **Миграции**: Скрипты обновления конфигураций

## Логирование

### Уровни логирования:
- **DEBUG**: Подробная информация для диагностики
- **INFO**: Общая информация о работе коннекторов
- **WARNING**: Предупреждения о потенциальных проблемах
- **ERROR**: Ошибки, требующие внимания
- **CRITICAL**: Критические ошибки, требующие немедленного вмешательства

### Структура логов:
- **Временные метки**: Точное время событий
- **Идентификаторы**: Уникальные ID подключений
- **Контекст**: Информация о состоянии подключений
- **Данные**: Передаваемые значения и параметры