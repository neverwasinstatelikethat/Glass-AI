# Бэкенд системы Glass AI

## Обзор

Бэкенд системы Glass AI реализован с использованием FastAPI и предоставляет REST API и WebSocket интерфейсы для взаимодействия с фронтендом и другими компонентами системы. Он интегрирует все модули ИИ и обеспечивает управление данными в реальном времени.

## Архитектура

Бэкенд состоит из следующих компонентов:

1. **FastAPI сервер** - основной веб-сервер
2. **Оркестратор конвейера** - координирует выполнение всех этапов обработки данных
3. **Модули ИИ** - интеграция моделей LSTM, Vision Transformer, GNN
4. **Система объяснимости** - генерация объяснений для прогнозов
5. **Агент обучения с подкреплением** - предоставляет рекомендации по оптимизации
6. **Непрерывное обучение** - адаптация моделей на основе новых данных

## Основные эндпоинты API

### Обработка данных через конвейер
```
POST /api/pipeline/process
```
Обрабатывает данные датчиков через весь конвейер:
- Инжиниринг признаков
- Прогнозы ИИ
- Объяснимость
- Рекомендации RL
- Автономные действия

### Получение инжиниринговых признаков
```
GET /api/features/latest
```
Возвращает последние вычисленные признаки.

### Получение объяснений прогнозов
```
GET /api/explainability/prediction
```
Возвращает объяснения SHAP для последнего прогноза.

### Получение метрик конвейера
```
GET /api/pipeline/metrics
```
Возвращает комплексные метрики производительности конвейера.

### Получение статуса автономии
```
GET /api/autonomy/status
```
Возвращает статус системы автономных действий.

### Получение статуса обучения
```
GET /api/training/status
```
Возвращает статус фреймворка непрерывного обучения.

## WebSocket интерфейс

Бэкенд предоставляет WebSocket интерфейс для передачи данных в реальном времени во фронтенд:

```javascript
// Подключение к WebSocket
const ws = new WebSocket('ws://localhost:8000/ws');

ws.onmessage = (event) => {
  const data = JSON.parse(event.data);
  
  if (data.type === 'pipeline_result') {
    // Обновление дашборда с:
    // - Инжиниринговыми признаками
    // - Прогнозами
    // - Объяснениями
    // - Рекомендациями
    // - Решениями автономных действий
    updateDashboard(data.data);
  }
};
```

## Модули ИИ

### LSTM прогнозор
- Многослойная LSTM с механизмами внимания
- Прогнозирование временных рядов для предсказания дефектов
- Оценка неопределенности

### Vision Transformer
- Обнаружение дефектов на изображениях МИК-1
- Сегментационная модель для точного определения местоположения дефектов
- Извлечение признаков из изображений

### Графовая нейронная сеть
- Анализ сети датчиков для обнаружения аномалий
- Pooling с механизмом внимания
- Построение графов сенсорной сети

### Ансамбль моделей
- Мета-обучение для комбинирования прогнозов
- Взвешенное голосование моделей
- Стекинг моделей

## Система объяснимости

### Model Explainer
- Интегрированный объяснитель для всех моделей
- Агрегация важности признаков
- Объяснения ансамбля

### Feature Attribution
- Расчет значений SHAP
- Объяснения LIME
- Генерация контрфактур

## Агент обучения с подкреплением

### PPO Optimizer
- Алгоритм Proximal Policy Optimization
- Оптимизация производственных параметров
- Оценка рисков для рекомендаций

### RL Training Pipeline
- Обучение в симуляции цифрового двойника
- Оценка эффективности действий
- Безопасное исследование

## Непрерывное обучение

### Continuous Learning Framework
- Буфер повторного воспроизведения опыта
- Регуляризация EWC для предотвращения катастрофического забывания
- Memory-Aware Synapses (MAS)
- Адаптация моделей к новым условиям

### AutoML Tuner
- Автоматическая настройка гиперпараметров
- Многокритериальная оптимизация с Optuna
- Автоматическая настройка моделей

## Установка и запуск

### Зависимости
```bash
pip install -r requirements.txt
```

### Запуск сервера
```bash
uvicorn fastapi_backend:app --host 0.0.0.0 --port 8000 --reload
```

### Docker
```bash
docker build -t glass-backend .
docker run -p 8000:8000 glass-backend
```

## Конфигурация

Бэкенд может быть сконфигурирован через:
1. Файл конфигурации `data_ingestion_config.json`
2. Переменные окружения в файле `.env`
3. Аргументы командной строки

## Мониторинг производительности

Бэкенд отслеживает метрики производительности для каждого этапа конвейера:
- Время извлечения признаков
- Время прогнозирования
- Время генерации объяснений
- Общая задержка конвейера

Эти метрики доступны через эндпоинт `/api/pipeline/metrics`.

## Безопасность

- Аутентификация по имени пользователя/паролю и сертификатам
- Шифрование TLS/SSL для всех соединений
- Контроль доступа на основе ролей

## Логирование

Бэкенд предоставляет подробное логирование:
- Логи инициализации системы
- Логи обработки данных
- Логи ошибок и предупреждений
- Метрики производительности

## Разработка

### Запуск тестов
```bash
pytest tests/
```

### Форматирование кода
```bash
black .
flake8 .
```

### Проверка типов
```bash
mypy .
```