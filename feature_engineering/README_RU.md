# Инжиниринг признаков Glass AI

## Обзор

Модуль инжиниринга признаков системы Glass AI отвечает за извлечение, преобразование и создание признаков из сырых данных датчиков для использования в моделях машинного обучения. Этот модуль обеспечивает преобразование временных рядов датчиков в значимые признаки, которые могут быть использованы для прогнозирования дефектов и оптимизации производства.

## Архитектура

```
Инжиниринг признаков
├── Признаки доменной области
│   ├── Физические признаки стекольного производства
│   ├── Энергоэффективность
│   └── Индикаторы качества
├── Статистические признаки
│   ├── Скользящие статистики
│   ├── Автокорреляция
│   └── Тренды
└── Признаки реального времени
    ├── Оконные функции
    ├── Агрегации InfluxDB
    └── Обновления в реальном времени
```

## Основные компоненты

### 1. Признаки доменной области (`domain_features.py`)
Извлечение физически значимых признаков, основанных на знаниях о процессе производства стекла.

#### Особенности:
- **Физические признаки**: Параметры, основанные на физике производства стекла
- **Энергоэффективность**: Показатели эффективности использования энергии
- **Индикаторы качества**: Признаки, указывающие на потенциальные проблемы качества

#### Примеры признаков:
- **Эффективность плавления**: Отношение температуры к времени плавления
- **Стабильность формования**: Стандартное отклонение скорости ленты
- **Качество отжига**: Соответствие температурному профилю
- **Вязкость стекла**: Расчет на основе температуры и состава

### 2. Статистические признаки (`statistical_features.py`)
Вычисление статистических характеристик временных рядов датчиков.

#### Особенности:
- **Скользящие статистики**: Средние, стандартные отклонения, минимумы, максимумы
- **Автокорреляция**: Самокорреляция временных рядов
- **Тренды**: Линейные тренды и их наклоны
- **Квантили**: Процентили распределений

#### Примеры признаков:
- **Скользящее среднее температуры**: Средняя температура за последние 5 минут
- **Стандартное отклонение давления**: Изменчивость давления
- **Максимальная скорость изменения**: Наибольшая скорость изменения параметра
- **Коэффициент автокорреляции**: Самокорреляция на лаге 1

### 3. Признаки реального времени (`real_time_features.py`)
Извлечение признаков в реальном времени из потоковых данных датчиков.

#### Особенности:
- **Оконные функции**: Признаки, вычисляемые в скользящих окнах
- **Агрегации InfluxDB**: Использование возможностей базы данных временных рядов
- **Обновления в реальном времени**: Непрерывное обновление признаков

#### Примеры признаков:
- **5-минутные агрегаты**: Средние, минимумы, максимумы за 5 минут
- **Скорость изменения**: Производная параметра по времени
- **Отклонение от нормы**: Разница между текущим значением и эталоном
- **Тренд последней минуты**: Наклон линейного тренда за последнюю минуту

## Типы признаков

### Временные признаки:
- **Время суток**: Час, минута, день недели
- **Сезонность**: Месяц, сезон года
- **Рабочие смены**: Идентификатор текущей смены

### Температурные признаки:
- **Температура печи**: Текущая температура плавления
- **Градиент температуры**: Скорость изменения температуры
- **Отклонение температуры**: Разница от целевого значения
- **Стабильность температуры**: Вариация температуры

### Признаки давления:
- **Давление в печи**: Текущее давление
- **Давление формования**: Давление при формовке изделия
- **Градиент давления**: Скорость изменения давления
- **Отклонение давления**: Разница от нормы

### Признаки скорости:
- **Скорость ленты**: Скорость перемещения формовочной ленты
- **Скорость охлаждения**: Скорость снижения температуры
- **Изменение скорости**: Ускорение/замедление процессов

### Признаки состава:
- **Соотношение компонентов**: Пропорции песка, соды, извести
- **Однородность шихты**: Степень равномерности смешивания
- **Отклонение от рецепта**: Разница от стандартного состава

## Методы извлечения признаков

### Скользящие окна:
- **Размер окна**: 1, 5, 15, 30 минут
- **Шаг окна**: 1 секунда, 1 минута
- **Агрегаты**: Среднее, медиана, стандартное отклонение, минимум, максимум

### Полиномиальные признаки:
- **Квадратичные члены**: Квадраты параметров
- **Перекрестные произведения**: Произведения пар параметров
- **Кубические члены**: Кубы параметров

### Фурье-признаки:
- **Спектральные компоненты**: Частотные компоненты временных рядов
- **Энергия спектра**: Энергия в различных частотных диапазонах
- **Доминирующие частоты**: Наиболее значимые частоты

## Интеграция с другими модулями

### С системой сбора данных:
- Получение сырых данных от датчиков
- Обработка потоковых данных в реальном времени
- Буферизация при временных сбоях

### С моделями ИИ:
- Предоставление признаков для обучения и вывода
- Стандартизация формата данных
- Обновление признаков в реальном времени

### С цифровым двойником:
- Использование симулированных данных для создания признаков
- Верификация признаков в контролируемых условиях
- Что-если анализ признаков

## Производительность

### Время обработки:
- **Извлечение доменных признаков**: ~5 мс
- **Вычисление статистических признаков**: ~10 мс
- **Обновление реал-тайм признаков**: ~2 мс
- **Полный цикл**: ~20 мс

### Пропускная способность:
- **Одиночный параметр**: 1000+ обновлений/сек
- **Комплексный набор**: 100+ обновлений/сек
- **Потоковая обработка**: 5000+ сообщений/сек

## Кэширование и оптимизация

### Кэширование признаков:
- **LRU кэш**: Хранение недавно вычисленных признаков
- **Инвалидация**: Автоматическая очистка устаревших значений
- **Размер кэша**: Настройка объема кэша

### Оптимизация вычислений:
- **Векторизация**: Использование NumPy для массовых вычислений
- **Параллелизм**: Многопоточность для независимых признаков
- **Ленивые вычисления**: Вычисление только запрашиваемых признаков

## Стандартизация данных

### Нормализация:
- **Min-Max_scaling**: Приведение к диапазону [0,1]
- **Z-score_normalization**: Стандартизация с μ=0, σ=1
- **Robust_scaling**: Нормализация по медиане и IQR

### Обработка выбросов:
- **IQR метод**: Удаление значений вне 1.5*IQR
- **Z-score фильтр**: Удаление значений с |z| > 3
- **Клиппинг**: Ограничение значений диапазоном

## Мониторинг качества признаков

### Метрики качества:
- **Полнота данных**: Процент отсутствующих значений
- **Стабильность признаков**: Изменение статистик во времени
- **Корреляция признаков**: Мультиколлинеарность
- **Значимость признаков**: Важность для моделей

### Визуализация:
- **Гистограммы распределений**: Форма распределений признаков
- **Матрица корреляций**: Взаимосвязи между признаками
- **Временные ряды**: Эволюция признаков во времени
- **Box plots**: Распределение и выбросы

## Тестирование

### Юнит-тесты:
```bash
pytest tests/feature_engineering/
```

### Тесты интеграции:
- Тестирование взаимодействия с системой сбора данных
- Тестирование предоставления признаков моделям
- Тестирование обработки граничных случаев

### Тесты производительности:
- Измерение времени извлечения признаков
- Тестирование масштабирования
- Стресс-тестирование при высокой нагрузке

## Развертывание

### Локальное развертывание:
```bash
python -m feature_engineering.domain_features
```

### Docker развертывание:
```dockerfile
FROM python:3.8-slim

WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt

COPY feature_engineering/ feature_engineering/

CMD ["python", "-m", "feature_engineering.domain_features"]
```

## Конфигурация

### Параметры конфигурации:
- **Размеры окон**: Настройка размеров скользящих окон
- **Частоты обновления**: Интервалы пересчета признаков
- **Пороги алертов**: Границы нормальных значений
- **Методы нормализации**: Выбор алгоритмов нормализации

### Формат конфигурации:
```json
{
  "window_sizes": {
    "short_term": 60,
    "medium_term": 300,
    "long_term": 900
  },
  "update_intervals": {
    "real_time": 1,
    "statistical": 60,
    "domain": 300
  },
  "normalization": {
    "method": "z_score",
    "clip_outliers": true,
    "outlier_threshold": 3.0
  }
}
```

## Безопасность

### Валидация входных данных:
- **Типы данных**: Проверка соответствия ожидаемым типам
- **Диапазоны значений**: Проверка нахождения в допустимых пределах
- **Формат времени**: Валидация временных меток

### Защита от атак:
- **Rate limiting**: Ограничение частоты запросов
- **Sanitization**: Очистка входных данных
- **Logging**: Логирование подозрительных действий

## Устранение неполадок

### Распространенные проблемы:

1. **Отсутствующие данные**:
   - Проверьте подключение к датчикам
   - Убедитесь в работоспособности системы сбора данных
   - Настройте стратегии заполнения пропусков

2. **Низкое качество признаков**:
   - Проверьте алгоритмы извлечения
   - Убедитесь в корректности нормализации
   - Проверьте наличие выбросов

3. **Проблемы с производительностью**:
   - Оптимизируйте вычисления
   - Увеличьте ресурсы системы
   - Настройте кэширование

## Версионирование

### Управление версиями:
- **SemVer**: Семантическое версионирование признаков
- **Git tags**: Тегирование релизов
- **Changelog**: Журнал изменений

### Откат версий:
- **Сохранение старых версий**: Архивирование предыдущих реализаций
- **Совместимость**: Поддержка обратной совместимости
- **Миграции**: Скрипты обновления признаков

## Логирование

### Уровни логирования:
- **DEBUG**: Подробная информация для диагностики
- **INFO**: Общая информация о работе системы
- **WARNING**: Предупреждения о потенциальных проблемах
- **ERROR**: Ошибки, требующие внимания
- **CRITICAL**: Критические ошибки, требующие немедленного вмешательства

### Структура логов:
- **Временные метки**: Точное время событий
- **Идентификаторы**: Уникальные ID операций
- **Контекст**: Информация о состоянии системы
- **Данные**: Значения признаков и параметры