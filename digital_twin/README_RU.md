# Цифровой двойник Glass AI

## Обзор

Цифровой двойник системы Glass AI представляет собой физически точную виртуальную модель производственной линии по изготовлению стекла. Он используется для симуляции производственных процессов, тестирования гипотез, оптимизации параметров и безопасного обучения систем ИИ без риска для реального производства.

## Архитектура

```
Цифровой двойник
├── Физические модели
│   ├── Тепловая динамика
│   ├── Модель вязкости
│   └── Анализ напряжений
├── Симулятор производства
│   ├── Движок симуляции
│   ├── Что-если анализ
│   └── Сценарии отказов
└── 3D визуализация
    ├── Модели оборудования
    ├── Анимации процессов
    └── Визуализация дефектов
```

## Основные компоненты

### 1. Физические модели (`physics_simulation.py`)
Реализация физических моделей, описывающих процессы производства стекла.

#### Особенности:
- **Тепловая динамика**: Моделирование теплообмена в печи
- **Модель вязкости**: Расчет вязкости стекла в зависимости от температуры
- **Анализ напряжений**: Расчет внутренних напряжений при охлаждении

### 2. Симулятор производства
Среда для симуляции производственных процессов и тестирования сценариев.

#### Особенности:
- **Движок симуляции**: Высокоточный движок для моделирования процессов
- **Что-если анализ**: Возможность тестирования различных сценариев
- **Сценарии отказов**: Моделирование аварийных ситуаций

### 3. 3D визуализация
Интерактивная трехмерная визуализация производственной линии.

#### Особенности:
- **Модели оборудования**: Точные 3D модели печи, формовочной линии, конвейера
- **Анимации процессов**: Анимация производственных процессов
- **Визуализация дефектов**: Отображение предсказанных дефектов

## Физические модели

### Тепловая динамика (`thermal_dynamics.py`)
Моделирование теплообмена и температурных режимов в печи плавления.

#### Уравнения модели:
```
∂T/∂t = α∇²T + Q/(ρc_p)
```
Где:
- T - температура
- t - время
- α - теплопроводность
- Q - тепловая мощность
- ρ - плотность
- c_p - удельная теплоемкость

#### Параметры модели:
- **Теплопроводность стекла**: λ = f(T)
- **Удельная теплоемкость**: c_p = f(T)
- **Плотность**: ρ = f(T)
- **Тепловая мощность**: Q = f(горелки, топливо)

### Модель вязкости (`viscosity_model.py`)
Расчет вязкости стекла в зависимости от температуры и состава.

#### Уравнение Френкеля:
```
η = A * exp(B/T)
```
Где:
- η - вязкость
- A, B - эмпирические коэффициенты
- T - температура

#### Параметры модели:
- **Коэффициенты вязкости**: A, B для различных составов
- **Температурный диапазон**: 1000-1600°C
- **Влияние состава**: Поправки для различных компонентов

### Анализ напряжений (`stress_analyzer.py`)
Расчет внутренних напряжений в стекле при охлаждении.

#### Уравнения термоупругости:
```
σ_ij = C_ijkl * (ε_kl - α_kl * ΔT)
```
Где:
- σ_ij - тензор напряжений
- C_ijkl - тензор упругих постоянных
- ε_kl - тензор деформаций
- α_kl - коэффициент термического расширения
- ΔT - перепад температур

## Симулятор производства

### Движок симуляции
Высокоточный движок для моделирования производственных процессов в реальном времени.

#### Возможности:
- **Параллельное моделирование**: Одновременная симуляция множества параметров
- **Адаптивное разрешение**: Изменение детализации в зависимости от требований
- **Событийная модель**: Дискретные события в непрерывной симуляции

### Что-если анализ
Инструмент для тестирования различных сценариев и гипотез.

#### Типы сценариев:
- **Изменение температуры печи**: ±100°C
- **Изменение скорости ленты**: ±20%
- **Изменение состава шихты**: ±5%
- **Отказ оборудования**: Остановка, снижение производительности

#### Результаты анализа:
- **Прогноз качества**: Ожидаемое количество дефектов
- **Производительность**: Изменение выхода годного продукта
- **Энергопотребление**: Изменение затрат энергии
- **Время цикла**: Изменение длительности процессов

### Сценарии отказов
Моделирование аварийных ситуаций для повышения отказоустойчивости.

#### Типы отказов:
- **Отказ нагревателей**: Потеря мощности печи
- **Отказ двигателей**: Остановка конвейера
- **Нарушение подачи газа**: Снижение температуры
- **Засорение форсунок**: Неравномерный нагрев

## 3D визуализация

### Модели оборудования
Точные трехмерные модели всех компонентов производственной линии.

#### Компоненты:
- **Печь плавления**: Модель с зонами нагрева
- **Формовочная линия**: Детализированная модель формующих машин
- **Конвейер охлаждения**: Модель системы отжига
- **Камеры контроля качества**: Модель МИК-1

### Анимации процессов
Анимация производственных процессов для лучшего понимания.

#### Анимации:
- **Плавление шихты**: Визуализация процесса плавления
- **Формование изделия**: Анимация формования стекла
- **Охлаждение**: Визуализация процесса отжига
- **Транспортировка**: Перемещение изделий по конвейеру

### Визуализация дефектов
Отображение предсказанных и реальных дефектов на 3D моделях.

#### Типы дефектов:
- **Трещины**: Визуализация мест возникновения трещин
- **Пузыри**: Отображение газовых включений
- **Сколы**: Повреждения кромок изделий
- **Деформации**: Отклонения формы от номинала

## Интеграция с другими модулями

### С моделями ИИ:
- **Валидация прогнозов**: Проверка прогнозов моделей в симуляциях
- **Генерация синтетических данных**: Создание обучающих данных
- **Тестирование гипотез**: Верификация моделей в контролируемых условиях

### С RL агентом:
- **Безопасное обучение**: Обучение агента без риска для реального производства
- **Тестирование стратегий**: Проверка RL политик в симуляциях
- **Оценка наград**: Расчет наград в симулированной среде

### С графом знаний:
- **Верификация причинно-следственных связей**: Проверка гипотез в симуляциях
- **Обновление графа**: Добавление новых связей на основе результатов симуляций
- **Что-если анализ**: Тестирование сценариев причинно-следственных цепочек

## API цифрового двойника

### Запуск симуляции:
```
POST /api/digital-twin/simulate
{
  "duration": 3600,
  "parameters": {
    "furnace_temperature": 1550,
    "belt_speed": 150,
    "mold_temp": 320
  }
}
```

### Что-если анализ:
```
POST /api/digital-twin/what-if
{
  "scenarios": [
    {
      "parameter": "furnace_temperature",
      "change": "+50"
    },
    {
      "parameter": "belt_speed",
      "change": "-10%"
    }
  ]
}
```

### Получение результатов:
```
GET /api/digital-twin/results/{simulation_id}
```

## Производительность

### Время симуляции:
- **1 час реального времени**: 5-10 минут симуляции
- **1 смена (8 часов)**: 30-60 минут симуляции
- **1 день**: 2-4 часа симуляции

### Требования к ресурсам:
- **CPU**: 4-8 ядер для реалистичной симуляции
- **RAM**: 8-16 ГБ для сложных моделей
- **GPU**: Опционально для 3D визуализации

## Конфигурация

### Параметры симуляции:
```json
{
  "time_step": 0.1,
  "simulation_duration": 3600,
  "physics_accuracy": "high",
  "visualization": {
    "enabled": true,
    "update_rate": 30
  }
}
```

### Модели оборудования:
- **Печь**: Геометрия, материалы, зоны нагрева
- **Формовочная линия**: Размеры, скорости, температурные режимы
- **Система охлаждения**: Профили температур, время отжига

## Безопасность

### Валидация параметров:
- **Диапазоны значений**: Проверка параметров на допустимость
- **Физические ограничения**: Проверка на соответствие физическим законам
- **Безопасные режимы**: Ограничение опасных комбинаций параметров

### Защита от атак:
- **Rate limiting**: Ограничение частоты симуляций
- **Resource limits**: Ограничение потребления ресурсов
- **Input sanitization**: Очистка входных данных

## Тестирование

### Юнит-тесты:
```bash
pytest tests/digital_twin/
```

### Тесты интеграции:
- Тестирование взаимодействия с моделями ИИ
- Тестирование API эндпоинтов
- Тестирование 3D визуализации

### Тесты производительности:
- Измерение времени симуляции
- Тестирование масштабирования
- Стресс-тестирование при высокой нагрузке

## Развертывание

### Локальное развертывание:
```bash
python -m digital_twin.physics_simulation
```

### Docker развертывание:
```dockerfile
FROM python:3.8-slim

WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt

COPY digital_twin/ digital_twin/

CMD ["python", "-m", "digital_twin.physics_simulation"]
```

## Мониторинг

### Метрики симуляции:
- **Время симуляции**: Фактическое время выполнения
- **Точность модели**: Отклонение от эталонных данных
- **Использование ресурсов**: CPU, RAM, GPU
- **Частота обновлений**: FPS визуализации

### Логирование:
- **Параметры симуляции**: Все входные параметры
- **Результаты**: Выходные данные симуляции
- **Ошибки**: Исключения и ошибки выполнения
- **Производительность**: Метрики времени выполнения

## Устранение неполадок

### Распространенные проблемы:

1. **Медленная симуляция**:
   - Проверьте ресурсы системы
   - Уменьшите точность модели
   - Оптимизируйте алгоритмы

2. **Нереалистичные результаты**:
   - Проверьте параметры моделей
   - Убедитесь в корректности входных данных
   - Сверьтесь с эталонными значениями

3. **Проблемы с визуализацией**:
   - Проверьте поддержку WebGL
   - Убедитесь в наличии необходимых ресурсов
   - Проверьте настройки отображения

## Расширяемость

### Добавление новых моделей:
- **Интерфейс модели**: Единый интерфейс для всех физических моделей
- **Плагин-система**: Возможность добавления моделей без изменения ядра
- **Конфигурация**: Настройка моделей через конфигурационные файлы

### Интеграция с внешними системами:
- **CAD системы**: Импорт геометрии из CAD
- **SCADA системы**: Интеграция с системами управления
- **MES системы**: Интеграция с системами управления производством

## Версионирование

### Управление версиями:
- **SemVer**: Семантическое версионирование моделей
- **Git tags**: Тегирование релизов
- **Changelog**: Журнал изменений

### Откат версий:
- **Сохранение старых версий**: Архивирование предыдущих реализаций
- **Совместимость**: Поддержка обратной совместимости
- **Миграции**: Скрипты обновления моделей

## Логирование

### Уровни логирования:
- **DEBUG**: Подробная информация для диагностики
- **INFO**: Общая информация о работе системы
- **WARNING**: Предупреждения о потенциальных проблемах
- **ERROR**: Ошибки, требующие внимания
- **CRITICAL**: Критические ошибки, требующие немедленного вмешательства

### Структура логов:
- **Временные метки**: Точное время событий
- **Идентификаторы**: Уникальные ID симуляций
- **Контекст**: Информация о состоянии системы
- **Данные**: Параметры и результаты симуляций