# Модуль потоковой обработки данных

## Описание

Модуль потоковой обработки данных отвечает за сбор, валидацию, маршрутизацию и распространение производственных данных в реальном времени. Он обеспечивает непрерывный поток информации от датчиков к ML-моделям и интерфейсу оператора.

## Компоненты

### 1. DataValidator ([data_validator.py](data_validator.py))

Валидатор данных промышленных датчиков, выполняющий проверку в реальном времени и обнаружение аномалий:

- **Валидация данных**: Проверка показаний датчиков на соответствие допустимым диапазонам
- **Обнаружение аномалий**: Использование статистических методов для выявления отклонений
- **Интерполяция пропусков**: Восстановление недостающих данных на основе исторических значений
- **Проверка согласованности**: Кросс-валидация показаний взаимосвязанных датчиков

#### Основные классы:
- `DataValidator` - основной класс валидации данных
- `DataQualityMonitor` - мониторинг качества данных

### 2. GlassProductionKafkaProducer ([kafka_producer.py](kafka_producer.py))

Асинхронный Kafka продюсер для публикации производственных данных:

- **Публикация в реальном времени**: Отправка данных датчиков, дефектов и прогнозов
- **Batch отправка**: Эффективная группировка сообщений для снижения нагрузки
- **Retry логика**: Автоматическое восстановление при временных сбоях
- **Мониторинг**: Отслеживание статистики отправки сообщений

#### Основные функции:
- `send_sensor_data()` - отправка данных датчиков
- `send_defect()` - отправка информации о дефектах
- `send_prediction()` - отправка прогнозов ML-моделей
- `send_alert()` - отправка алертов
- `send_recommendation()` - отправка рекомендаций

### 3. MQTTBrokerConnector ([mqtt_broker.py](mqtt_broker.py))

Коннектор к MQTT брокеру для коммуникации с IoT устройствами:

- **Безопасное подключение**: Поддержка TLS и аутентификации
- **Подписка на топики**: Получение данных от различных устройств
- **Публикация команд**: Отправка управляющих команд оборудованию
- **Обработка сообщений**: Асинхронная обработка входящих данных

#### Основные функции:
- `connect()` - подключение к MQTT брокеру
- `subscribe()` - подписка на топики
- `publish()` - публикация сообщений
- `publish_sensor_data()` - отправка данных датчиков
- `send_control_command()` - отправка команд управления

### 4. WebSocketBroadcaster ([websocket_broadcaster.py](websocket_broadcaster.py))

Широковещательный WebSocket сервер для обновления дашборда в реальном времени:

- **ML-ориентированный подход**: Интеграция с LSTM, GNN и RL моделями
- **Широковещательная рассылка**: Одновременное обновление всех подключенных клиентов
- **Канальная система**: Разделение потоков данных по категориям
- **Обогащение данных**: Интеграция с графом знаний для контекстной информации

#### Основные классы:
- `MLInferencePipeline` - конвейер ML-выводов
- `WebSocketBroadcaster` - широковещательный сервер
- Функции потоков: `sensor_data_stream_task`, `defect_detection_stream_task`, `quality_metrics_stream_task`, `recommendations_stream_task`

## Как это работает

1. **Сбор данных**: Данные поступают от датчиков через MQTT или напрямую
2. **Валидация**: `DataValidator` проверяет корректность данных и обнаруживает аномалии
3. **Маршрутизация**: `KafkaProducer` отправляет данные в соответствующие топики
4. **Обработка**: ML-модели обрабатывают данные для прогнозов и рекомендаций
5. **Распространение**: `WebSocketBroadcaster` отправляет актуальные данные на дашборд

## Использование

### Валидация данных

```python
from streaming_pipeline.data_validator import DataValidator

validator = DataValidator()
validation_result = validator.validate_sensor_data(sensor_data)
```

### Публикация в Kafka

```python
from streaming_pipeline.kafka_producer import GlassProductionKafkaProducer

producer = GlassProductionKafkaProducer()
await producer.start()
await producer.send_sensor_data(sensor_data)
```

### Подключение к MQTT

```python
from streaming_pipeline.mqtt_broker import MQTTBrokerConnector

mqtt_client = MQTTBrokerConnector(broker_host="localhost", broker_port=1883)
await mqtt_client.connect()
await mqtt_client.publish_sensor_data(sensor_data)
```

### WebSocket широковещание

```python
from streaming_pipeline.websocket_broadcaster import WebSocketBroadcaster

broadcaster = WebSocketBroadcaster()
await broadcaster.broadcast_sensor_update(sensor_data)
```

## Назначение

Этот модуль используется для:
1. **Сбора данных**: Получение информации от всех датчиков производства
2. **Валидации данных**: Обеспечение качества и достоверности данных
3. **Маршрутизации**: Направление данных в соответствующие системы обработки
4. **Реального времени**: Обеспечение минимальной задержки при передаче данных
5. **Масштабируемости**: Поддержка большого количества подключений и высокой пропускной способности

## Связанные компоненты

- [Модели](../models/README_RU.md) - ML-модели для обработки данных
- [Дашборд](../frontend/README_RU.md) - интерфейс оператора
- [Хранилище](../storage/README_RU.md) - долговременное хранение данных
- [Обучение](../training/README_RU.md) - обучение моделей на потоковых данных